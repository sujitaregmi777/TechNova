{% extends "base.html" %}
{% load static %}
{% block title %}MoodMate ¬∑ Chat{% endblock %}

{% block content %}

<div class="max-w-5xl mx-auto mt-6 flex flex-col h-[85vh]">

  <!-- HEADER BAR -->
  <div class="flex items-center justify-between border-b border-[var(--border)] pb-3 mb-3">

    <!-- Back -->
    <a href="{% url 'chat_list' %}" class="text-xl text-[var(--muted)] hover:text-[var(--text)]">
      ‚Üê
    </a>

    <!-- Title -->
    <div class="text-center">
      <h2 class="text-xl font-semibold text-[var(--text)]">MoodMate</h2>
      <p class="text-xs text-[var(--muted)]">Your mate for every moods</p>
    </div>

    <!-- Know Yourself Better -->
    <a href="{% url 'generate_chat_insight' session.id %}"
       class="px-3 py-1.5 rounded-lg bg-[var(--primary)] text-white text-xs font-medium">
       Generate Audio Insights
    </a>

  </div>


  <!-- CHAT BODY -->
  <div id="chat-body"
       class="flex-1 overflow-y-auto space-y-4 px-1">

    {% for message in messages %}
      
      {% if message.sender == "ai" %}
      <!-- AI Message -->
      <div class="flex items-start gap-3">
        <img src="{% static 'images/moodmate_logo.png' %}"
             class="w-9 h-9 rounded-full">

        <div class="bg-[var(--surface)] border border-[var(--border)]
                    rounded-2xl px-4 py-2 text-sm max-w-[75%]">
          {{ message.text }}
        </div>
      </div>
      {% endif %}


      {% if message.sender == "user" %}
      <!-- User Message -->
      <div class="flex items-start gap-3 justify-end">
        
        <div class="bg-[var(--primary)] text-white
                    rounded-2xl px-4 py-2 text-sm max-w-[75%]">
          {{ message.text }}
        </div>

        <img src="{% static 'images/user_avatar.png' %}"
             class="w-9 h-9 rounded-full">
      </div>
      {% endif %}

    {% endfor %}
  </div>


  <!-- INPUT AREA -->
  <form method="POST" class="mt-3">
    {% csrf_token %}

    <div class="flex items-center gap-2 bg-[var(--surface)]
                border border-[var(--border)]
                rounded-xl px-3 py-2">

      <!-- Attach (future image upload) -->
      <span class="text-lg text-[var(--muted)] cursor-pointer">üìé</span>

      <input type="text"
             name="message"
             placeholder="Type your message..."
             required
             class="flex-1 bg-transparent outline-none text-sm">

      <button type="submit"
              class="w-9 h-9 rounded-full bg-[var(--primary)]
                     text-white flex items-center justify-center">
        ‚û§
      </button>
    </div>
  </form>

</div>


<script>
  // Auto-scroll to bottom
  const chatBody = document.getElementById("chat-body");
  chatBody.scrollTop = chatBody.scrollHeight;
</script>

{% endblock %}
