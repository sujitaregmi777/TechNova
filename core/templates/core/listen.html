{% extends "base.html" %}
{% load static %}

{% block content %}

<div class="min-h-screen flex items-center justify-center bg-gradient-to-br from-emerald-50 via-white to-teal-100 px-4">

  <div class="max-w-3xl w-full">

    <!-- Title -->
    <h1 class="text-3xl md:text-4xl font-semibold text-center text-gray-800 mb-2">
      {{ podcast.title }}
    </h1>

    <!-- Date -->
    <div class="text-center text-sm text-gray-500 mb-10">
      <i class="fa-regular fa-calendar mr-1"></i>
      {{ podcast.created_at|date:"F j, Y ‚Ä¢ H:i" }}
    </div>

    <!-- Player Card -->
    <div class="backdrop-blur-xl bg-white/70 border border-white/40 rounded-3xl shadow-xl p-8">

      <!-- Hidden Audio -->
      <audio id="audioPlayer">
        <source src="{{ podcast.audio_file.url }}" type="audio/mpeg">
      </audio>

      <!-- Player Row -->
      <div class="flex items-center gap-5">

        <!-- Play Button -->
        <button id="playBtn"
          class="w-14 h-14 rounded-full bg-gradient-to-br from-emerald-400 to-teal-500 
                 text-white flex items-center justify-center shadow-lg 
                 hover:scale-105 active:scale-95 transition">
          <i id="playIcon" class="fa-solid fa-play text-lg"></i>
        </button>

        <!-- Info -->
        <div class="flex-1">
          <div class="font-medium text-gray-800">
            Now Playing
          </div>
          <div class="text-xs text-gray-500 mt-1">
            <span id="currentTime">0:00</span>
            /
            <span id="duration">0:00</span>
          </div>
        </div>

        <!-- Volume -->
        <button onclick="toggleMute()" class="text-gray-600 hover:text-gray-900 transition">
          <i id="volumeIcon" class="fa-solid fa-volume-high text-lg"></i>
        </button>
      </div>

      <!-- Progress Bar -->
      <div class="mt-6">
        <input id="progressBar"
               type="range"
               value="0"
               min="0"
               step="0.1"
               class="w-full h-2 rounded-full appearance-none bg-gray-200 accent-emerald-500 cursor-pointer">
      </div>

      <!-- Mood text -->
      <div class="text-center text-xs text-gray-500 mt-4">
        Take a breath. Let your thoughts flow üåø
      </div>

    </div>

    <!-- Back Button -->
    <div class="text-center mt-10">
      <a href="{% url 'dashboard' %}"
         class="px-6 py-2 rounded-full bg-gray-800 text-white text-sm 
                hover:bg-gray-700 transition shadow">
        ‚Üê Back to dashboard
      </a>
    </div>

  </div>
</div>


<!-- Player Script -->
<script>
const audio = document.getElementById("audioPlayer");
const playBtn = document.getElementById("playBtn");
const playIcon = document.getElementById("playIcon");
const progressBar = document.getElementById("progressBar");
const currentTimeEl = document.getElementById("currentTime");
const durationEl = document.getElementById("duration");
const volumeIcon = document.getElementById("volumeIcon");

function formatTime(sec){
    const minutes = Math.floor(sec / 60);
    const seconds = Math.floor(sec % 60).toString().padStart(2,'0');
    return `${minutes}:${seconds}`;
}

audio.addEventListener("loadedmetadata", () => {
    durationEl.textContent = formatTime(audio.duration);
    progressBar.max = audio.duration;
});

playBtn.addEventListener("click", () => {
    if(audio.paused){
        audio.play();
        playIcon.classList.replace("fa-play","fa-pause");
    } else {
        audio.pause();
        playIcon.classList.replace("fa-pause","fa-play");
    }
});

audio.addEventListener("timeupdate", () => {
    progressBar.value = audio.currentTime;
    currentTimeEl.textContent = formatTime(audio.currentTime);
});

progressBar.addEventListener("input", () => {
    audio.currentTime = progressBar.value;
});

function toggleMute(){
    audio.muted = !audio.muted;
    volumeIcon.className = audio.muted
        ? "fa-solid fa-volume-xmark text-lg"
        : "fa-solid fa-volume-high text-lg";
}
</script>

{% endblock %}
