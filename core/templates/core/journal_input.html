{% extends "base.html" %}
{% block title %}Reflection · MoodMate{% endblock %}

{% block content %}
<div class="max-w-3xl mx-auto flex flex-col gap-12">

  <!-- Header -->
  <section class="flex flex-col gap-3">
    <h1 class="text-3xl sm:text-4xl font-bold leading-tight">
      {% if form.instance.pk %}
        Continue your reflection
      {% else %}
        A quiet space to write
      {% endif %}
        </h1>

    <p class="text-[var(--muted)] max-w-xl">
      There’s no right way to do this. Just notice what feels present.
    </p>
  </section>

  <!-- Reflection Card -->
  <section
    class="rounded-3xl p-6 sm:p-8
           bg-[var(--surface)]
           border border-[var(--border)]
           shadow-sm
           flex flex-col gap-8
           transition-all duration-300
           hover:shadow-md">

    <form method="post" class="flex flex-col gap-7">
      {% csrf_token %}

      <!-- Mood Selector -->
      <div class="flex flex-col gap-3">
        <label class="text-sm font-medium text-[var(--muted)]">
          How are you feeling right now?
        </label>

 <div class="grid grid-cols-3 sm:grid-cols-6 gap-4" id="moodSelect">

  <button type="button" data-mood="happy" class="mood-pill mood-box">
    <span class="material-symbols-outlined">sentiment_satisfied</span>
    <span class="label">Happy</span>
  </button>

  <button type="button" data-mood="sad" class="mood-pill mood-box">
    <span class="material-symbols-outlined">sentiment_dissatisfied</span>
    <span class="label">Sad</span>
  </button>

  <button type="button" data-mood="anxious" class="mood-pill mood-box">
    <span class="material-symbols-outlined">sentiment_neutral</span>
    <span class="label">Anxious</span>
  </button>

  <button type="button" data-mood="calm" class="mood-pill mood-box">
    <span class="material-symbols-outlined">water_drop</span>
    <span class="label">Calm</span>
  </button>

  <button type="button" data-mood="grateful" class="mood-pill mood-box">
    <span class="material-symbols-outlined">favorite</span>
    <span class="label">Grateful</span>
  </button>

  <button type="button" data-mood="overwhelmed" class="mood-pill mood-box">
    <span class="material-symbols-outlined">waves</span>
    <span class="label">Overwhelmed</span>
  </button>

</div>



        <!-- Hidden real input -->
        <input type="hidden" name="mood" id="id_mood" value="{{ form.mood.value|default:'' }}">
      </div>

      <!-- Content -->
      <div class="flex flex-col gap-1">
        <label class="text-sm font-medium text-[var(--muted)]">
          What’s on your mind?
        </label>
        {{ form.content }}
        <p class="text-xs text-[var(--muted)] mt-1">
          You don’t have to explain everything — a few words is enough.
        </p>
      </div>

      <!-- Actions -->
<div class="flex flex-wrap items-center gap-3 pt-5 border-t border-[var(--border)]">

  <!-- Save reflection only -->
  <button type="submit" name="action" value="save"
    class="px-6 py-3 rounded-xl
           bg-[var(--primary)] text-white
           font-medium
           hover:scale-[1.02]
           active:scale-[0.98]
           transition-all">
    Save reflection
  </button>

  <!-- Explore insights (Generate podcast) -->
  <button type="submit" name="action" value="podcast"
    class="group flex items-center gap-2 px-5 py-3 rounded-xl
           border border-[var(--border)]
           hover:border-[var(--primary)]
           hover:bg-[var(--surface-alt)]
           transition">

      <span class="material-symbols-outlined text-[var(--muted)]
                   group-hover:text-[var(--primary)] transition">
        psychology
      </span>

      <span class="text-sm">
        Explore insights
      </span>
  </button>

  <!-- Go to AI chat -->
  <button type="submit" name="action" value="chat"
    class="group flex items-center gap-2 px-5 py-3 rounded-xl
           border border-[var(--border)]
           hover:border-[var(--primary)]
           hover:bg-[var(--surface-alt)]
           transition">

      <span class="material-symbols-outlined text-[var(--muted)]
                   group-hover:text-[var(--primary)] transition">
        headphones
      </span>

      <span class="text-sm">
        Chat with AI
      </span>
  </button>

</div>


      </div>
    </form>
  </section>

  <!-- Gentle reassurance -->
  <section class="text-sm text-[var(--muted)] max-w-xl">
    Writing things down doesn’t change everything —
    but it often changes how heavy things feel.
  </section>

</div>

<!-- Mood Pill Script -->
<script>
  const pills = document.querySelectorAll(".mood-pill");
  const moodInput = document.querySelector("input[name='mood']");

if (moodInput.value) {
    pills.forEach(pill => {
      if (pill.dataset.mood === moodInput.value) {
        pill.classList.add("bg-[var(--primary)]", "text-white");
      }
    });
  }

  pills.forEach(pill => {
    pill.addEventListener("click", () => {
      pills.forEach(p =>
        p.classList.remove("bg-[var(--primary)]", "text-white")
      );
      pill.classList.add("bg-[var(--primary)]", "text-white");
      moodInput.value = pill.dataset.mood;
    });
  });
</script>

{% endblock %}
