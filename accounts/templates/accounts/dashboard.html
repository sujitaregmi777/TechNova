{% extends "base.html" %}
{% block title %}Dashboard ¬∑ MoodMate{% endblock %}

{% block content %}
<div class="max-w-5xl mx-auto flex flex-col gap-10">

  <!-- GREETING -->
  <section>
    <h1 class="text-3xl sm:text-4xl font-bold">
      {% if user.is_authenticated %}
        Welcome back{% if user.first_name %}, {{ user.first_name }}{% endif %}
      {% else %}
        Welcome üå±
      {% endif %}
    </h1>
    <p class="text-[var(--muted)] mt-2">
      Take a moment. There‚Äôs no rush here.
    </p>
  </section>

  <!-- MOOD SELECTOR -->
  <section
    class="rounded-3xl p-6 bg-[var(--surface)]
           border border-[var(--border)]
           flex flex-col gap-5">

    <h2 class="text-lg font-semibold">
      How are you feeling right now?
    </h2>

    <!-- Emoji buttons -->
<div class="grid grid-cols-3 sm:grid-cols-6 gap-4 px-2">

  <!-- Happy -->
  <button type="button" onclick="setMood('happy')"
    class="group flex flex-col items-center gap-2 p-3 rounded-2xl
           border border-[var(--border)]
           hover:border-[var(--primary)]
           hover:bg-[var(--surface-alt)]
           transition">
    <span class="material-symbols-outlined text-3xl text-[var(--primary)]
                 group-hover:scale-110 transition">
      sentiment_satisfied
    </span>
    <span class="text-xs font-medium text-[var(--primary)]">Happy</span>
  </button>

  <!-- Sad -->
  <button type="button" onclick="setMood('sad')"
    class="group flex flex-col items-center gap-2 p-3 rounded-2xl
           border border-[var(--border)]
           hover:border-[var(--primary)]
           hover:bg-[var(--surface-alt)]
           transition">
    <span class="material-symbols-outlined text-3xl text-[var(--muted)]
                 group-hover:text-[var(--primary)] transition">
      sentiment_dissatisfied
    </span>
    <span class="text-xs font-medium text-[var(--muted)]">Sad</span>
  </button>

  <!-- Anxious -->
  <button type="button" onclick="setMood('anxious')"
    class="group flex flex-col items-center gap-2 p-3 rounded-2xl
           border border-[var(--border)]
           hover:border-[var(--primary)]
           hover:bg-[var(--surface-alt)]
           transition">
    <span class="material-symbols-outlined text-3xl text-[var(--muted)]
                 group-hover:text-[var(--primary)] transition">
      sentiment_neutral
    </span>
    <span class="text-xs font-medium text-[var(--muted)]">Anxious</span>
  </button>

  <!-- Calm -->
  <button type="button" onclick="setMood('calm')"
    class="group flex flex-col items-center gap-2 p-3 rounded-2xl
           border border-[var(--border)]
           hover:border-[var(--primary)]
           hover:bg-[var(--surface-alt)]
           transition">
    <span class="material-symbols-outlined text-3xl text-[var(--muted)]
                 group-hover:text-[var(--primary)] transition">
      water_drop
    </span>
    <span class="text-xs font-medium text-[var(--muted)]">Calm</span>
  </button>

  <!-- Grateful -->
  <button type="button" onclick="setMood('grateful')"
    class="group flex flex-col items-center gap-2 p-3 rounded-2xl
           border border-[var(--border)]
           hover:border-[var(--primary)]
           hover:bg-[var(--surface-alt)]
           transition">
    <span class="material-symbols-outlined text-3xl text-[var(--muted)]
                 group-hover:text-[var(--primary)] transition">
      volunteer_activism
    </span>
    <span class="text-xs font-medium text-[var(--muted)]">Grateful</span>
  </button>

  <!-- Overwhelmed -->
  <button type="button" onclick="setMood('overwhelmed')"
    class="group flex flex-col items-center gap-2 p-3 rounded-2xl
           border border-[var(--border)]
           hover:border-[var(--primary)]
           hover:bg-[var(--surface-alt)]
           transition">
    <span class="material-symbols-outlined text-3xl text-[var(--muted)]
                 group-hover:text-[var(--primary)] transition">
      waves
    </span>
    <span class="text-xs font-medium text-[var(--muted)]">Overwhelmed</span>
  </button>

</div>



    <!-- Progress bar -->
    <div class="w-full h-3 rounded-full bg-[var(--surface-alt)] overflow-hidden">
      <div id="moodBar"
           class="h-full w-[50%] bg-[var(--primary)] transition-all duration-500">
      </div>
    </div>

    <p id="moodText" class="text-sm text-[var(--muted)] text-center">
      Current state: steady and present
    </p>
  </section>

 <!-- RECENT PRESENCE -->
<section class="rounded-3xl p-6 bg-[var(--surface)]
               border border-[var(--border)] flex flex-col gap-2">

  <h3 class="text-base font-semibold">Your recent presence</h3>

  {% if user.is_authenticated and streak %}
    {% if streak.current_streak > 0 %}
      <p class="text-sm text-[var(--muted)]">
        üî• You‚Äôre on a <strong>{{ streak.current_streak }}-day</strong> presence streak.
        Showing up matters.
      </p>
    {% else %}
      <p class="text-sm text-[var(--muted)]">
        Today can be your first step. Just check in once.
      </p>
    {% endif %}
  {% else %}
    <p class="text-sm text-[var(--muted)]">
      You‚Äôve returned here before. That‚Äôs enough for today.
    </p>
  {% endif %}

</section>
<!-- 

    <div class="flex gap-2 mt-2">
      <span class="px-3 py-1 rounded-full text-xs
                   bg-[var(--primary)]/10 text-[var(--primary)]">
        Checked in this week
      </span>
      <span class="px-3 py-1 rounded-full text-xs
                   bg-[var(--primary)]/10 text-[var(--primary)]">
        Building a gentle rhythm
      </span>
    </div> -->
  </section>
  
  <!-- LATEST PODCAST -->
<section class="rounded-3xl p-6 bg-[var(--surface)]
               border border-[var(--border)] flex flex-col gap-3">

  <h3 class="text-base font-semibold">Latest podcast</h3>

  {% if latest_podcast %}
    
    {% if processing %}
      <div class="flex items-center gap-3">
        <div class="w-3 h-3 rounded-full bg-[var(--primary)] animate-ping"></div>
        <p class="text-sm text-[var(--muted)]">Processing your latest episode...</p>
      </div>
    {% else %}
      <p class="text-sm font-medium">{{ latest_podcast.title }}</p>
      <a href="{% url 'listen_podcast' latest_podcast.id %}"
         class="text-sm text-[var(--primary)] hover:underline">
        Listen now ‚Üí
      </a>
    {% endif %}

  {% else %}
    <p class="text-sm text-[var(--muted)]">
      No podcasts yet ‚Äî write a reflection to begin.
    </p>
  {% endif %}
</section>

  <!-- LATEST REFLECTION -->
  <section class="rounded-3xl p-6 bg-[var(--surface)]
                 border border-[var(--border)] flex flex-col gap-3">
    <h3 class="text-base font-semibold">Your latest reflection</h3>

    {% if latest_reflection %}
      <p class="text-sm italic">
        ‚Äú{{ latest_reflection.content|truncatechars:120 }}‚Äù
      </p>
      <p class="text-xs text-[var(--muted)]">
        {{ latest_reflection.created_at|timesince }} ago
      </p>
      <a href="{% url 'journal_edit' latest_reflection.id %}"
         class="text-sm font-medium text-[var(--primary)] hover:underline">
        Continue this reflection ‚Üí
      </a>
    {% else %}
      <p class="text-sm text-[var(--muted)]">
        You haven‚Äôt written anything yet.
      </p>
      <a href=""
         class="text-sm font-medium text-[var(--primary)] hover:underline">
        Start with one sentence ‚Üí
      </a>
    {% endif %}
  </section>

  <!-- QUICK ACTIONS -->
  <section class="grid grid-cols-1 sm:grid-cols-2 gap-6">

    <a href="{% url 'journal_create' %}"
       class="rounded-3xl p-6 bg-[var(--surface)]
              border border-[var(--border)]
              hover:border-[var(--primary)] transition">
      <h4 class="font-semibold">Write a reflection</h4>
      <p class="text-sm text-[var(--muted)] mt-1">
        Let your thoughts settle on the page.
      </p>
    </a>

    <a href=""
       class="rounded-3xl p-6 bg-[var(--surface)]
              border border-[var(--border)]
              hover:border-[var(--primary)] transition">
      <h4 class="font-semibold">Talk it out</h4>
      <p class="text-sm text-[var(--muted)] mt-1">
        A calm conversation, without judgment.
      </p>
    </a>

  </section>

  <!-- BREATHING CTA -->
  <section
    class="rounded-3xl p-6 bg-[var(--surface-alt)]
           border border-[var(--border)]
           flex flex-col sm:flex-row
           sm:items-center sm:justify-between gap-4">

    <div>
      <h4 class="font-semibold">Need a quiet reset?</h4>
      <p class="text-sm text-[var(--muted)]">
        A short breathing session can help your body slow down.
      </p>
    </div>

    <a href="{% url 'breathing' %}"
       class="px-6 py-3 rounded-xl bg-white text-black font-medium">
      Start breathing
    </a>
  </section>

  <!-- ANONYMOUS NOTICE -->
  {% if not user.is_authenticated %}
    <p class="text-xs text-center text-[var(--muted)]">
      Your reflections are saved on this device.
      <a href="{% url 'register' %}" class="text-[var(--primary)] hover:underline">
        Create an account
      </a>
      to keep them safe everywhere.
    </p>
  {% endif %}

</div>


<!-- JS -->
<script>
function setMood(mood) {
  window.location.href =
    "{% url 'journal_create' %}?mood=" + mood;
}
</script>

{% endblock %}
